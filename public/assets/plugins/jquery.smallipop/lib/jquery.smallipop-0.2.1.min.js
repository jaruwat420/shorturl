/*!
Smallipop (10/14/2012)
Copyright (c) 2011-2012 Small Improvements (http://www.small-improvements.com)

Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.

@author Sebastian Helzle (sebastian@helzle.net)
*/
(function(a){a.smallipop={version:"0.2.1",defaults:{contentAnimationSpeed:150,cssAnimations:{enabled:false,show:"animated fadeIn",hide:"animated fadeOut"},funcEase:"easeInOutQuad",handleInputs:true,hideTrigger:false,hideOnPopupClick:true,hideOnTriggerClick:true,horizontal:false,infoClass:"smallipopHint",invertAnimation:false,popupOffset:31,popupYOffset:0,popupDistance:20,popupDelay:100,popupAnimationSpeed:200,preferredPosition:"top",theme:"default",touchSupport:true,triggerAnimationSpeed:150,triggerOnClick:false,onAfterHide:null,onAfterShow:null,onBeforeHide:null,onBeforeShow:null,windowPadding:30},popup:null,lastId:1,_hideSmallipop:function(h){var m,b,k,j,i,d,f,l,c,g;j=a.smallipop;b=j.popup;k=b.data("shown");i=(h!=null?h.target:void 0)?a(h.target):null;d=a(".smallipop"+k);f=((g=d.data("smallipop"))!=null?g.options:void 0)||j.defaults;if(i&&d.length&&(h!=null?h.type:void 0)==="click"&&((!f.hideOnTriggerClick&&i.is(d))||(!f.hideOnPopupClick&&b.find(i).length))){return}if(k&&f.hideTrigger){d.stop(true).fadeTo(f.triggerAnimationSpeed,1)}m=f.invertAnimation?-1:1;l=j.popup.data("xDistance")*m;c=j.popup.data("yDistance")*m;b.data({hideDelayTimer:null,beingShown:false});if(f.cssAnimations.enabled){b.removeClass(f.cssAnimations.show).addClass(f.cssAnimations.hide).data("shown","");return typeof f.onAfterHide==="function"?f.onAfterHide():void 0}else{return b.stop(true).animate({top:"-="+l+"px",left:"+="+c+"px",opacity:0},f.popupAnimationSpeed,f.funcEase,function(){var e;e=a(this);if(!e.data("beingShown")){e.css("display","none").data("shown","")}return typeof f.onAfterHide==="function"?f.onAfterHide():void 0})}},_showSmallipop:function(g){var c,b,d,f;b=a.smallipop;c=a(this);d=c.data("smallipop");if(b.popup.data("shown")!==d.id&&((f=!d.type)==="checkbox"||f==="radio")){if(g!=null){g.preventDefault()}}return b._triggerMouseover.call(this)},onTouchDevice:function(){return typeof Modernizr!=="undefined"&&Modernizr!==null?Modernizr.touch:void 0},killTimers:function(){var c,b,d;b=a.smallipop.popup;c=b.data("hideDelayTimer");d=b.data("showDelayTimer");if(c){clearTimeout(c)}if(d){return clearTimeout(d)}},refreshPosition:function(){var f,n,b,l,g,c,y,w,m,j,k,i,p,x,B,z,D,e,t,v,C,s,h,d,r,u,q,A,o;C=a.smallipop;c=C.popup;v=c.data("shown");if(!v){return}s=a(".smallipop"+v);g=s.data("smallipop").options;c.removeClass().addClass(g.theme);h=a(window);q=A=g.popupDistance;o=g.popupYOffset;l=s.offset();i=c.outerHeight();B=c.outerWidth();y=B/2;r=h.width();d=h.height();u=g.windowPadding;e=s.outerWidth();D=s.outerHeight();t=l.top-h.scrollTop();p=l.left+e/2;x=l.top-i+o;z=i+g.popupDistance-o;k=t-z;w=d-t-D-z;m=l.left-B-g.popupOffset;j=r-l.left-e-B;if(g.horizontal){q=0;x+=D/2+i/2;if((g.preferredPosition==="left"&&m>u)||j<u){c.addClass("sipPositionedLeft");p=l.left-B-g.popupOffset;A=-A}else{c.addClass("sipPositionedRight");p=l.left+e+g.popupOffset}}else{A=0;if(p+y>r-u){p-=y*2-g.popupOffset;c.addClass("sipAlignLeft")}else{if(p-y<u){p-=g.popupOffset;c.addClass("sipAlignRight")}else{p-=y}}if((g.preferredPosition==="bottom"&&w>u)||k<u){x+=i+D-2*o;q=-q;o=0;c.addClass("sipAlignBottom")}}if(g.hideTrigger){s.stop(true).fadeTo(g.triggerAnimationSpeed,0)}n=c.data("beingShown");if(!n||g.cssAnimations.enabled){x-=q;p+=A;q=0;A=0}c.data({xDistance:q,yDistance:A});b={top:x,left:p,display:"block",opacity:n&&!g.cssAnimations.enabled?0:1};f={top:"-="+q+"px",left:"+="+A+"px",opacity:1};if(g.cssAnimations.enabled){c.addClass(g.cssAnimations.show).css(b);if(n){c.data("beingShown",false);return typeof g.onAfterShow==="function"?g.onAfterShow(s):void 0}}else{return c.stop(true).css(b).animate(f,g.popupAnimationSpeed,g.funcEase,function(){if(n){c.data("beingShown",false);return typeof g.onAfterShow==="function"?g.onAfterShow(s):void 0}})}},_getTrigger:function(b){return a(".smallipop"+b)},_showPopup:function(d){var h,g,c,e,b,f;b=a.smallipop;c=b.popup;if(!c.data("triggerHovered")){return}f=d.data("smallipop");e=c.data("shown");if(e){h=b._getTrigger(e);g=h.data("smallipop").options||b.defaults;if(g.hideTrigger){h.stop(true).fadeTo(g.fadeSpeed,1)}}c.data({beingShown:true,shown:f.id});b.popupContent.html(f.hint);return b.refreshPosition()},_triggerMouseover:function(){var h,e,c,d,f,b,g;d=a(this);b=a.smallipop;c=b.popup;h=(g=d.data("smallipop"))!=null?g.id:void 0;f=c.data("shown");b.killTimers();c.data((h?"triggerHovered":"hovered"),true);if(!h){d=b._getTrigger(f);h=f}if(!d.length){return}e=d.data("smallipop").options;if(typeof e.onBeforeShow==="function"){e.onBeforeShow(d)}if(f!==h){return c.data("showDelayTimer",setTimeout(function(){return b._showPopup(d)},e.popupDelay))}},_triggerMouseout:function(){var i,f,d,c,e,g,b,h;e=a(this);i=(h=e.data("smallipop"))!=null?h.id:void 0;b=a.smallipop;d=b.popup;c=d.data();g=c.shown;b.killTimers();d.data((i?"triggerHovered":"hovered"),false);if(!i){e=b._getTrigger(g)}f=e.data("smallipop").options;if(typeof f.onBeforeHide==="function"){f.onBeforeHide(e)}if(!(c.hovered||c.triggerHovered)){return d.data("hideDelayTimer",setTimeout(b._hideSmallipop,500))}},_onWindowResize:function(){return a.smallipop.refreshPosition()},_onWindowClick:function(f){var c,b,d;b=a.smallipop;c=b.popup;d=a(f.target);if(!(d.is(c)||d.closest(".sipInitialized").length)){return b._hideSmallipop(f)}},setContent:function(f){var d,e,b,c;b=a.smallipop;e=b.popup.data("shown");c=b._getTrigger(e);d=c.data("smallipop").options;return b.popupContent.stop(true).fadeTo(d.contentAnimationSpeed,0,function(){b.popupContent.html(f).fadeTo(d.contentAnimationSpeed,1);return b.refreshPosition()})},_destroy:function(b){return b.each(function(){var d,c;c=a(this);d=c.data("smallipop");if(d){return c.unbind(".smallipop").data("smallipop",{}).removeClass("smallipop sipInitialized smallipop"+d.id+" "+d.options.theme)}})},_init:function(){var c,b;b=a.smallipop;c=b.popup=a('          <div id="smallipop">            <div class="sipContent"/>            <div class="sipArrowBorder"/>            <div class="sipArrow"/>          </div>        ').css("opacity",0).data({xDistance:0,yDistance:0}).bind({"mouseover.smallipop":b._triggerMouseover,"mouseout.smallipop":b._triggerMouseout});b.popupContent=c.find(".sipContent");a("body").append(c);c.delegate("a","click.smallipop",b._hideSmallipop);a(document).bind("click.smallipop touchend.smallipop",b._onWindowClick);return a(window).bind("resize.smallipop",b._onWindowResize)}};if(!a.easing.easeInOutQuad){a.easing.easeInOutQuad=function(f,g,e,i,h){if((g/=h/2)<1){return i/2*g*g+e}else{return -i/2*((--g)*(g-2)-1)+e}}}return a.fn.smallipop=function(c,d){var b;if(c==null){c={}}if(d==null){d=""}b=a.smallipop;if(typeof c==="string"){switch(c.toLowerCase()){case"show":b._showSmallipop.call(this.first().get(0));break;case"hide":b._hideSmallipop();break;case"destroy":b._destroy(this)}return this}c=a.extend({},b.defaults,c);if(c.moveSpeed!=null){c.popupAnimationSpeed=c.moveSpeed}if(c.hideSpeed!=null){c.triggerAnimationSpeed=c.hideSpeed}if((typeof Modernizr!=="undefined"&&Modernizr!==null?Modernizr.cssanimations:void 0)===false){c.cssAnimations.enabled=false}if(!b.popup){b._init()}return this.each(function(){var e,h,g,f,i,l,k,j;f=a(this);i=f[0].tagName.toLowerCase();j=f.attr("type");g=d||f.attr("title")||f.find("."+c.infoClass).html();if(g&&!f.hasClass("sipInitialized")){h=b.lastId++;k=a.extend(true,{},c);l={};e=k.handleInputs&&(i==="input"||i==="select"||i==="textarea");if(e){k.hideOnTriggerClick=false;l["focus.smallipop"]=b._triggerMouseover;l["blur.smallipop"]=b._triggerMouseout}else{l["mouseout.smallipop"]=b._triggerMouseout}if(k.triggerOnClick||(k.touchSupport&&b.onTouchDevice())){l["click.smallipop"]=b._showSmallipop}else{l["click.smallipop"]=b._hideSmallipop;l["mouseover.smallipop"]=b._triggerMouseover}f.addClass("sipInitialized smallipop"+h).attr("title","").data("smallipop",{id:h,hint:g,options:k,tagName:i,type:j}).bind(l);if(!k.hideOnTriggerClick){return f.delegate("a","click.smallipop",b._hideSmallipop)}}})}})(jQuery);